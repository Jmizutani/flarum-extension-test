(()=>{var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";const t=flarum.core.compat["forum/app"];var r=e.n(t);function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t)}const a=flarum.core.compat["common/Model"];var n=e.n(a),s=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).userId=n().attribute("userId"),t.introduction=n().attribute("introduction"),t.childcareSituation=n().attribute("childcareSituation"),t.careSituation=n().attribute("careSituation"),t.facebookUrl=n().attribute("facebookUrl"),t.xUrl=n().attribute("xUrl"),t.instagramUrl=n().attribute("instagramUrl"),t.isVisible=n().attribute("isVisible"),t.createdAt=n().attribute("createdAt",n().transformDate),t.updatedAt=n().attribute("updatedAt",n().transformDate),t.user=n().hasOne("user"),t}return o(t,e),t}(n()),l=function(e){function t(){for(var t,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(t=e.call.apply(e,[this].concat(i))||this).name=n().attribute("name"),t.label=n().attribute("label"),t.type=n().attribute("type"),t.required=n().attribute("required"),t.sortOrder=n().attribute("sortOrder"),t.isActive=n().attribute("isActive"),t.createdAt=n().attribute("createdAt",n().transformDate),t.updatedAt=n().attribute("updatedAt",n().transformDate),t}return o(t,e),t}(n());const u=flarum.core.compat["common/Component"];var c=e.n(u);const d=flarum.core.compat["common/components/Button"];var f=e.n(d);function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)({}).hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},p.apply(null,arguments)}const h=flarum.core.compat["common/components/Modal"];var v=e.n(h);const b=flarum.core.compat["common/components/Switch"];var g=e.n(b);const y=flarum.core.compat["common/utils/Stream"];var U=e.n(y);function F(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return N(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?N(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function N(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}var k=function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.oninit=function(t){e.prototype.oninit.call(this,t);var r=this.attrs.profile||{};this.facebookUrl=U()(r.facebookUrl||""),this.xUrl=U()(r.xUrl||""),this.instagramUrl=U()(r.instagramUrl||""),this.isVisible=U()(void 0===r.isVisible||r.isVisible),this.loading=!1,this.fieldsLoading=!0,this.fields=[],this.customFields={},r.customFields&&(this.customFields=p({},r.customFields)),this.loadFields()},r.loadFields=function(){var e=this;app.store.find("profile-fields").then(function(t){e.fields=t.sort(function(e,t){return e.sortOrder()-t.sortOrder()}),e.fields.forEach(function(t){e.customFields[t.name()]?e.customFields[t.name()]=U()(e.customFields[t.name()]):e.customFields[t.name()]=U()("")}),e.fieldsLoading=!1,m.redraw()}).catch(function(){e.fieldsLoading=!1,m.redraw()})},r.className=function(){return"UserProfileModal Modal--large"},r.title=function(){return"プロフィール編集"},r.content=function(){var e=this;return this.fieldsLoading?m("div",{className:"Modal-body"},m("div",{className:"LoadingIndicator"})):m("div",{className:"Modal-body"},m("div",{className:"Form"},this.fields.map(function(t){return e.renderCustomField(t)}),m("div",{className:"Form-group"},m("h4",null,"ソーシャルリンク")),m("div",{className:"Form-group"},m("label",null,"Facebook URL"),m("input",{className:"FormControl",type:"url",value:this.facebookUrl(),oninput:function(t){return e.facebookUrl(t.target.value)},placeholder:"https://facebook.com/username"})),m("div",{className:"Form-group"},m("label",null,"X (Twitter) URL"),m("input",{className:"FormControl",type:"url",value:this.xUrl(),oninput:function(t){return e.xUrl(t.target.value)},placeholder:"https://x.com/username"})),m("div",{className:"Form-group"},m("label",null,"Instagram URL"),m("input",{className:"FormControl",type:"url",value:this.instagramUrl(),oninput:function(t){return e.instagramUrl(t.target.value)},placeholder:"https://instagram.com/username"})),m("div",{className:"Form-group"},m(g(),{state:this.isVisible(),onchange:this.isVisible},"プロフィールを他のユーザーに公開する")),m("div",{className:"Form-group"},m(f(),{className:"Button Button--primary",type:"submit",loading:this.loading},"保存"),m(f(),{className:"Button Button--default",onclick:this.hide.bind(this)},"キャンセル"))))},r.renderCustomField=function(e){var t=this.customFields[e.name()];return t?m("div",{key:e.id(),className:"Form-group"},m("label",null,e.label(),e.required()&&m("span",{className:"required"},"*")),"textarea"===e.type()?m("textarea",{className:"FormControl",value:t(),oninput:function(e){return t(e.target.value)},rows:"4",placeholder:e.label()+"を入力してください",required:e.required()}):m("input",{className:"FormControl",type:"text",value:t(),oninput:function(e){return t(e.target.value)},placeholder:e.label()+"を入力してください",required:e.required()})):null},r.onsubmit=function(e){var t=this;e.preventDefault();for(var r,i=F(this.fields);!(r=i()).done;){var o=r.value;if(o.required()&&o.isActive()){var a=this.customFields[o.name()];if(!a||!a().trim())return void alert(o.label()+"は必須項目です。")}}this.loading=!0,m.redraw();for(var n,s={},l=F(this.fields);!(n=l()).done;){var u=n.value,c=this.customFields[u.name()];c&&(s[u.name()]=c())}var d={userId:app.session.user.id(),facebookUrl:this.facebookUrl(),xUrl:this.xUrl(),instagramUrl:this.instagramUrl(),isVisible:this.isVisible(),customFields:s};app.store.createRecord("user-profiles").save(d).then(function(){t.hide(),m.redraw()}).catch(function(){t.loading=!1,m.redraw()})},t}(v()),w=function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.oninit=function(t){e.prototype.oninit.call(this,t),this.user=this.attrs.user,this.profile=null,this.fields=[],this.loading=!0,this.fieldsLoading=!0,this.loadProfile(),this.loadFields()},r.loadProfile=function(){var e=this;app.store.find("user-profiles",{userId:this.user.id()}).then(function(t){e.profile=t,e.loading=!1,m.redraw()}).catch(function(){e.loading=!1,m.redraw()})},r.loadFields=function(){var e=this;app.store.find("profile-fields").then(function(t){e.fields=t.sort(function(e,t){return e.sortOrder()-t.sortOrder()}),e.fieldsLoading=!1,m.redraw()}).catch(function(){e.fieldsLoading=!1,m.redraw()})},r.view=function(){var e=this;if(this.loading||this.fieldsLoading)return m("div",{className:"UserProfileWidget"},"読み込み中...");var t=app.session.user&&app.session.user.id()===this.user.id(),r=this.profile&&(this.profile.isVisible()||t||app.session.user&&app.session.user.isAdmin());return m("div",{className:"UserProfileWidget"},m("div",{className:"UserProfileWidget-header"},m("h3",null,"プロフィール"),t&&m(f(),{className:"Button Button--primary Button--small",onclick:function(){return app.modal.show(k,{profile:e.profile})}},"編集")),r&&this.profile?m("div",{className:"UserProfileWidget-content"},this.renderCustomFields(),(this.profile.facebookUrl()||this.profile.xUrl()||this.profile.instagramUrl())&&m("div",{className:"UserProfileWidget-section"},m("h4",null,"ソーシャルリンク"),m("div",{className:"UserProfileWidget-socialLinks"},this.profile.facebookUrl()&&m("a",{href:this.profile.facebookUrl(),target:"_blank",rel:"noopener noreferrer"},"Facebook"),this.profile.xUrl()&&m("a",{href:this.profile.xUrl(),target:"_blank",rel:"noopener noreferrer"},"X (Twitter)"),this.profile.instagramUrl()&&m("a",{href:this.profile.instagramUrl(),target:"_blank",rel:"noopener noreferrer"},"Instagram"))),!this.profile.isVisible()&&t&&m("div",{className:"UserProfileWidget-section"},m("em",null,"このプロフィールは非公開に設定されています。"))):m("div",{className:"UserProfileWidget-content"},t?m("div",{className:"UserProfileWidget-empty"},m("p",null,"プロフィールが設定されていません。"),m(f(),{className:"Button Button--primary",onclick:function(){return app.modal.show(k,{profile:null})}},"プロフィールを作成")):m("div",{className:"UserProfileWidget-empty"},m("p",null,"プロフィールは非公開に設定されています。"))))},r.renderCustomFields=function(){if(!this.profile.customFields)return null;var e=this.profile.customFields(),t=[];return this.fields.forEach(function(r){r.isActive()&&e[r.name()]&&t.push(m("div",{key:r.id(),className:"UserProfileWidget-section"},m("h4",null,r.label()),m("p",null,e[r.name()])))}),t},t}(c());const A=flarum.core.compat["common/extend"],P=flarum.core.compat["forum/components/UserPage"];var x=e.n(P);r().initializers.add("flarum-user-profile",function(){r().store.models["user-profiles"]=s,r().store.models["profile-fields"]=l,(0,A.extend)(x().prototype,"sidebarItems",function(e){e.add("userProfile",m(w,{user:this.user}),10)})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map