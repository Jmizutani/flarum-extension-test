# Flarum User Profile Extension

ユーザープロフィール拡張機能は、管理者が自由にカスタマイズできるプロフィール項目とソーシャルリンクを提供するFlarum拡張機能です。

## 機能

### 📋 **カスタムプロフィールフィールド**
- **動的フィールド作成**: 管理者が自由にプロフィール項目を追加・編集・削除
- **フィールドタイプ**: テキスト（1行）またはテキストエリア（複数行）
- **必須設定**: フィールドごとに必須/任意を設定可能
- **並び順制御**: フィールドの表示順序をカスタマイズ
- **有効/無効切替**: フィールドの表示/非表示を制御

### 🔗 **ソーシャルリンク**
- **動的リンク管理**: 管理者がソーシャルリンクの種類を追加・編集・削除
- **標準設定**: Facebook、X (Twitter)、Instagramが初期設定で利用可能
- **カスタマイズ**: アイコン、ラベル、URL形式を自由に設定

### 🔒 **プライバシー設定**
- **公開/非公開設定**: プロフィール全体の表示制御
- **権限管理**: 本人と管理者のみが非公開プロフィールを閲覧可能

## インストール

1. 拡張機能をFlarumのextensionsディレクトリに配置
2. 以下のコマンドを実行してComposer依存関係をインストール:
   ```bash
   composer install
   ```

3. フロントエンドアセットをビルド:
   ```bash
   npm install
   npm run build
   ```

4. Flarum管理パネルで拡張機能を有効化

## 使用方法

### 🔧 **管理者: カスタムフィールドの設定**

1. Flarum管理画面にアクセス
2. 拡張機能 → "User Profile" を選択
3. 「新しいフィールドを追加」をクリック
4. フィールド情報を入力:
   - **フィールド名**: 内部識別名（例: introduction）
   - **表示ラベル**: ユーザーに表示される名前（例: 自己紹介）
   - **フィールドタイプ**: テキストまたはテキストエリア
   - **必須設定**: 必須フィールドかどうか
   - **並び順**: 表示順序（数値）
5. 「保存」をクリック

### 🔧 **管理者: ソーシャルリンクの設定**

1. Flarum管理画面の「User Profile」設定内で「ソーシャルリンク」タブを選択
2. 「新しいソーシャルリンクを追加」をクリック
3. リンク情報を入力:
   - **リンク名**: 内部識別名（例: github）
   - **表示ラベル**: ユーザーに表示される名前（例: GitHub）
   - **アイコン**: Font Awesomeアイコン名（例: fab fa-github）
   - **URL形式**: プレースホルダー付きURL（例: https://github.com/{username}）
4. 「保存」をクリック

### 👤 **ユーザー: プロフィールの編集**

1. ユーザープロフィールページにアクセス
2. 「プロフィール」ウィジェットで「編集」ボタンをクリック
3. 設定されたカスタムフィールドに情報を入力
4. ソーシャルリンクを入力（任意）
5. 「プロフィールを他のユーザーに公開する」の設定を選択
6. 「保存」ボタンをクリック

### 👁️ **プロフィールの表示**

- **公開プロフィール**: すべてのユーザーが閲覧可能
- **非公開プロフィール**: 本人と管理者のみ閲覧可能
- **カスタムフィールド**: 管理者が設定した順序で表示
- **ソーシャルリンク**: 入力されたリンクが表示

## 技術仕様

### 📊 **データベース構造**

- **`profile_fields`**: カスタムフィールド定義テーブル
- **`profile_field_values`**: ユーザーのフィールド値テーブル
- **`user_profiles`**: ユーザープロフィール基本情報（可視性設定）
- **`social_links`**: ソーシャルリンク定義テーブル
- **`user_social_links`**: ユーザーのソーシャルリンク値テーブル

### 🔌 **API エンドポイント**

**カスタムフィールド管理（管理者）**
- `GET /api/profile-fields` - カスタムフィールド一覧取得
- `POST /api/profile-fields` - カスタムフィールド作成
- `PATCH /api/profile-fields/{id}` - カスタムフィールド更新
- `DELETE /api/profile-fields/{id}` - カスタムフィールド削除

**ソーシャルリンク管理（管理者）**
- `GET /api/social-links` - ソーシャルリンク一覧取得
- `POST /api/social-links` - ソーシャルリンク作成
- `PATCH /api/social-links/{id}` - ソーシャルリンク更新
- `DELETE /api/social-links/{id}` - ソーシャルリンク削除

**ユーザープロフィール**
- `GET /api/user-profiles?userId={id}` - ユーザープロフィール取得
- `POST /api/user-profiles` - ユーザープロフィール作成/更新

### 🏗️ **アーキテクチャ**

- **PHP Backend**: Laravel Eloquentモデル、JSON APIコントローラー
- **JavaScript Frontend**: Mithrilコンポーネント、Flarum拡張API
- **データ移行**: 既存の固定フィールドから動的フィールドへの自動移行

## 開発

### ビルドコマンド

```bash
# 開発モード（ウォッチ）
npm run watch

# 本番ビルド
npm run build

# 開発ビルド
npm run build:dev
```

### デバッグとメンテナンス

```bash
# Flarumキャッシュクリア（PHP変更後）
php flarum cache:clear

# 拡張機能情報確認
php flarum info

# データベースマイグレーション実行
php flarum migrate
```

- フロントエンドの変更は自動的にリロードされます
- バックエンドの変更後は必ずキャッシュクリアを実行

## ライセンス

MIT License