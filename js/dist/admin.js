(()=>{var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var i in r)t.o(r,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:r[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["admin/app"];var r=t.n(e);function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i(t,e)}const n=flarum.core.compat["common/Model"];var a=t.n(n),l=function(t){function e(){for(var e,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).userId=a().attribute("userId"),e.introduction=a().attribute("introduction"),e.childcareSituation=a().attribute("childcareSituation"),e.careSituation=a().attribute("careSituation"),e.facebookUrl=a().attribute("facebookUrl"),e.xUrl=a().attribute("xUrl"),e.instagramUrl=a().attribute("instagramUrl"),e.isVisible=a().attribute("isVisible"),e.createdAt=a().attribute("createdAt",a().transformDate),e.updatedAt=a().attribute("updatedAt",a().transformDate),e.user=a().hasOne("user"),e}return o(e,t),e}(a()),s=function(t){function e(){for(var e,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).name=a().attribute("name"),e.label=a().attribute("label"),e.type=a().attribute("type"),e.required=a().attribute("required"),e.sortOrder=a().attribute("sortOrder"),e.isActive=a().attribute("isActive"),e.createdAt=a().attribute("createdAt",a().transformDate),e.updatedAt=a().attribute("updatedAt",a().transformDate),e}return o(e,t),e}(a());function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function c(t){var e=function(t){if("object"!=u(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==u(e)?e:e+""}function d(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,c(i.key),i)}}const f=flarum.core.compat["common/components/Page"];var p=t.n(f);const h=flarum.core.compat["common/components/Button"];var v=t.n(h);const b=flarum.core.compat["common/components/LoadingIndicator"];var y=t.n(b);const g=flarum.core.compat["common/components/Modal"];var N=t.n(g);const F=flarum.core.compat["common/components/Switch"];var P=t.n(F);const O=flarum.core.compat["common/utils/Stream"];var A=t.n(O),w=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e);var r=this.attrs.field;this.name=A()(r?r.name():""),this.label=A()(r?r.label():""),this.type=A()(r?r.type():"text"),this.required=A()(!!r&&r.required()),this.sortOrder=A()(r?r.sortOrder():0),this.isActive=A()(!r||r.isActive()),this.loading=!1},r.className=function(){return"ProfileFieldModal Modal--medium"},r.title=function(){return this.attrs.field?"フィールドを編集":"新しいフィールドを追加"},r.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"フィールド名 (内部名)"),m("input",{className:"FormControl",type:"text",value:this.name(),oninput:function(e){return t.name(e.target.value)},placeholder:"例: introduction",disabled:!!this.attrs.field}),this.attrs.field&&m("p",{className:"helpText"},"既存フィールドの内部名は変更できません。")),m("div",{className:"Form-group"},m("label",null,"表示ラベル"),m("input",{className:"FormControl",type:"text",value:this.label(),oninput:function(e){return t.label(e.target.value)},placeholder:"例: 自己紹介"})),m("div",{className:"Form-group"},m("label",null,"フィールドタイプ"),m("select",{className:"FormControl",value:this.type(),onchange:function(e){return t.type(e.target.value)}},m("option",{value:"text"},"テキスト（1行）"),m("option",{value:"textarea"},"テキストエリア（複数行）"))),m("div",{className:"Form-group"},m("label",null,"並び順"),m("input",{className:"FormControl",type:"number",value:this.sortOrder(),oninput:function(e){return t.sortOrder(parseInt(e.target.value)||0)},min:"0"})),m("div",{className:"Form-group"},m(P(),{state:this.required(),onchange:this.required},"必須フィールド")),m("div",{className:"Form-group"},m(P(),{state:this.isActive(),onchange:this.isActive},"有効")),m("div",{className:"Form-group"},m(v(),{className:"Button Button--primary",type:"submit",loading:this.loading},"保存"),m(v(),{className:"Button Button--default",onclick:this.hide.bind(this)},"キャンセル"))))},r.onsubmit=function(t){var e=this;if(t.preventDefault(),this.name()&&this.label()){this.loading=!0,m.redraw();var r={name:this.name(),label:this.label(),type:this.type(),required:this.required(),sortOrder:this.sortOrder(),isActive:this.isActive()};(this.attrs.field?this.attrs.field.save(r):app.store.createRecord("profile-fields").save(r)).then(function(){e.hide(),e.attrs.onsubmit&&e.attrs.onsubmit()}).catch(function(){e.loading=!1,m.redraw()})}else alert("フィールド名と表示ラベルは必須です。")},e}(N()),I=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var r,i,n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.loading=!0,this.fields=[],this.loadFields()},n.loadFields=function(){var t=this;this.loading=!0,app.store.find("profile-fields").then(function(e){t.fields=e.sort(function(t,e){return t.sortOrder()-e.sortOrder()}),t.loading=!1,m.redraw()}).catch(function(){t.loading=!1,m.redraw()})},n.view=function(){var t=this;return this.loading?m("div",{className:"ProfileFieldsPage"},m(y(),null)):m("div",{className:"ProfileFieldsPage"},m("div",{className:"ProfileFieldsPage-header"},m("div",{className:"container"},m("h2",null,"プロフィールフィールド設定"),m(v(),{className:"Button Button--primary",onclick:function(){return t.showModal()}},"新しいフィールドを追加"))),m("div",{className:"ProfileFieldsPage-content"},m("div",{className:"container"},0===this.fields.length?m("div",{className:"ProfileFieldsPage-empty"},m("p",null,"プロフィールフィールドが設定されていません。")):m("div",{className:"ProfileFieldsList"},this.fields.map(function(e){return t.fieldItem(e)})))))},n.fieldItem=function(t){var e=this;return m("div",{key:t.id(),className:"ProfileFieldItem"},m("div",{className:"ProfileFieldItem-info"},m("div",{className:"ProfileFieldItem-label"},t.label()),m("div",{className:"ProfileFieldItem-details"},m("span",{className:"ProfileFieldItem-name"},"(",t.name(),")"),m("span",{className:"ProfileFieldItem-type"},t.type()),t.required()&&m("span",{className:"ProfileFieldItem-required"},"必須"))),m("div",{className:"ProfileFieldItem-controls"},m(v(),{className:"Button Button--link",onclick:function(){return e.showModal(t)}},"編集"),m(v(),{className:"Button Button--link",onclick:function(){return e.deleteField(t)}},"削除")))},n.showModal=function(t){var e=this;void 0===t&&(t=null),app.modal.show(w,{field:t,onsubmit:function(){return e.loadFields()}})},n.deleteField=function(t){var e=this;confirm("フィールド「"+t.label()+"」を削除してもよろしいですか？")&&t.delete().then(function(){return e.loadFields()}).catch(function(t){console.error("Delete error:",t)})},r=e,i=[{key:"route",get:function(){return"profile-fields"}}],null&&d(r.prototype,null),i&&d(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}(p());r().initializers.add("flarum-user-profile",function(){r().store.models["user-profiles"]=l,r().store.models["profile-fields"]=s,console.log("User Profile Admin extension loaded"),["junya/flarum-user-profile","junya-flarum-user-profile"].forEach(function(t){console.log("Trying extension ID: "+t),r().extensionData.for(t).registerPage(I),r().extensionData.for(t).registerSetting({setting:"user-profile-enabled",label:"プロフィール機能を有効にする",type:"boolean",default:!0})}),console.log("Extension page registered"),console.log("Available routes:",r().routes)})})(),module.exports={}})();
//# sourceMappingURL=admin.js.map