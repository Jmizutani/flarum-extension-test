(()=>{var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var i in r)t.o(r,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:r[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["admin/app"];var r=t.n(e);function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i(t,e)}const l=flarum.core.compat["common/Model"];var n=t.n(l),a=function(t){function e(){for(var e,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).userId=n().attribute("userId"),e.facebookUrl=n().attribute("facebookUrl"),e.xUrl=n().attribute("xUrl"),e.instagramUrl=n().attribute("instagramUrl"),e.isVisible=n().attribute("isVisible"),e.customFields=n().attribute("customFields"),e.createdAt=n().attribute("createdAt",n().transformDate),e.updatedAt=n().attribute("updatedAt",n().transformDate),e.user=n().hasOne("user"),e}return o(e,t),e}(n()),s=function(t){function e(){for(var e,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).name=n().attribute("name"),e.label=n().attribute("label"),e.type=n().attribute("type"),e.placeholder=n().attribute("placeholder"),e.required=n().attribute("required"),e.sortOrder=n().attribute("sortOrder"),e.isActive=n().attribute("isActive"),e.createdAt=n().attribute("createdAt",n().transformDate),e.updatedAt=n().attribute("updatedAt",n().transformDate),e}return o(e,t),e}(n()),c=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e}(n());function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function d(t){var e=function(t){if("object"!=u(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==u(e)?e:e+""}function p(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,d(i.key),i)}}Object.assign(c.prototype,{name:n().attribute("name"),label:n().attribute("label"),iconUrl:n().attribute("iconUrl"),placeholder:n().attribute("placeholder"),sortOrder:n().attribute("sortOrder"),isActive:n().attribute("isActive"),createdAt:n().attribute("createdAt"),updatedAt:n().attribute("updatedAt")});const h=flarum.core.compat["common/Component"];var f=t.n(h);const b=flarum.core.compat["common/components/Button"];var v=t.n(b);const y=flarum.core.compat["common/components/LoadingIndicator"];var g=t.n(y);const x=flarum.core.compat["common/components/Modal"];var N=t.n(x);const k=flarum.core.compat["common/components/Switch"];var F=t.n(k);const w=flarum.core.compat["common/utils/Stream"];var A=t.n(w),L=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e);var r=this.attrs.field;this.name=A()(r?r.name():""),this.label=A()(r?r.label():""),this.type=A()(r?r.type():"text"),this.placeholder=A()(r?r.placeholder():""),this.required=A()(!!r&&r.required()),this.sortOrder=A()(r?r.sortOrder():0),this.isActive=A()(!r||r.isActive()),this.loading=!1,this.errors={}},r.className=function(){return"ProfileFieldModal Modal--medium"},r.title=function(){return this.attrs.field?"フィールドを編集":"新しいフィールドを追加"},r.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"フィールド名 (内部名) ",m("span",{className:"required"},"*")),m("input",{className:"FormControl "+(this.errors.name?"FormControl--error":""),type:"text",value:this.name(),oninput:function(e){return t.name(e.target.value)},placeholder:"例: introduction",disabled:!!this.attrs.field,required:!0}),this.errors.name&&m("div",{className:"Form-error"},this.errors.name),this.attrs.field&&m("p",{className:"helpText"},"既存フィールドの内部名は変更できません。")),m("div",{className:"Form-group"},m("label",null,"表示ラベル ",m("span",{className:"required"},"*")),m("input",{className:"FormControl "+(this.errors.label?"FormControl--error":""),type:"text",value:this.label(),oninput:function(e){return t.label(e.target.value)},placeholder:"例: 自己紹介",required:!0}),this.errors.label&&m("div",{className:"Form-error"},this.errors.label)),m("div",{className:"Form-group"},m("label",null,"フィールドタイプ"),m("select",{className:"FormControl",value:this.type(),onchange:function(e){return t.type(e.target.value)}},m("option",{value:"text"},"テキスト（1行）"),m("option",{value:"textarea"},"テキストエリア（複数行）"))),m("div",{className:"Form-group"},m("label",null,"プレースホルダー"),m("input",{className:"FormControl",type:"text",value:this.placeholder(),oninput:function(e){return t.placeholder(e.target.value)},placeholder:"ユーザーの入力欄に表示される例文"}),m("div",{className:"helpText"},"ユーザーがフィールドを入力する際のヒントとして表示されます。")),m("div",{className:"Form-group"},m("label",null,"並び順"),m("input",{className:"FormControl",type:"number",value:this.sortOrder(),oninput:function(e){return t.sortOrder(parseInt(e.target.value)||0)},min:"0"})),m("div",{className:"Form-group"},m(F(),{state:this.required(),onchange:this.required},"必須フィールド")),m("div",{className:"Form-group"},m(F(),{state:this.isActive(),onchange:this.isActive},"有効")),m("div",{className:"Form-group"},m(v(),{className:"Button Button--primary",type:"submit",loading:this.loading},"保存"),m(v(),{className:"Button Button--default",onclick:this.hide.bind(this)},"キャンセル"))))},r.onsubmit=function(t){var e=this;if(t.preventDefault(),this.errors={},this.name()&&""!==this.name().trim()||(this.errors.name="フィールド名は必須です。"),this.label()&&""!==this.label().trim()||(this.errors.label="表示ラベルは必須です。"),Object.keys(this.errors).length>0)m.redraw();else{this.loading=!0,m.redraw();var r,i={name:this.name(),label:this.label(),type:this.type(),placeholder:this.placeholder(),required:this.required(),sortOrder:this.sortOrder(),isActive:this.isActive()};if(this.attrs.field){var o={url:app.forum.attribute("apiUrl")+"/profile-fields/"+this.attrs.field.id(),method:"PATCH",body:{data:{type:"profile-fields",id:this.attrs.field.id(),attributes:i}}};console.log("ProfileField update request:",o),r=app.request(o).then(function(t){return console.log("ProfileField update response:",t),app.store.pushPayload(t),app.store.getById("profile-fields",e.attrs.field.id())}).catch(function(t){throw console.error("ProfileField update error:",t),t})}else r=app.store.createRecord("profile-fields").save(i);r.then(function(){e.hide(),e.attrs.onsubmit&&e.attrs.onsubmit()}).catch(function(){e.loading=!1,m.redraw()})}},e}(N()),O=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var r=e.prototype;return r.oninit=function(e){var r,i,o,l,n,a,s;t.prototype.oninit.call(this,e),this.socialLink=this.attrs.socialLink,this.name=A()((null==(r=this.socialLink)?void 0:r.name())||""),this.label=A()((null==(i=this.socialLink)?void 0:i.label())||""),this.iconUrl=A()((null==(o=this.socialLink)?void 0:o.iconUrl())||""),this.placeholder=A()((null==(l=this.socialLink)?void 0:l.placeholder())||""),this.sortOrder=A()((null==(n=this.socialLink)?void 0:n.sortOrder())||0),this.isActive=A()(null==(a=null==(s=this.socialLink)?void 0:s.isActive())||a),this.errors={}},r.className=function(){return"SocialLinkModal Modal--medium"},r.title=function(){return this.socialLink?"ソーシャルリンクを編集":"新しいソーシャルリンクを追加"},r.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,"名前 (内部用) ",m("span",{className:"required"},"*")),m("input",{className:"FormControl "+(this.errors.name?"FormControl--error":""),type:"text",placeholder:"facebook, x, instagram など",bidi:this.name,required:!0}),this.errors.name&&m("div",{className:"Form-error"},this.errors.name),m("div",{className:"helpText"},"システム内部で使用される識別子です。英数字とアンダースコアのみ使用可能。")),m("div",{className:"Form-group"},m("label",null,"表示名 ",m("span",{className:"required"},"*")),m("input",{className:"FormControl "+(this.errors.label?"FormControl--error":""),type:"text",placeholder:"Facebook, X (Twitter), Instagram など",bidi:this.label,required:!0}),this.errors.label&&m("div",{className:"Form-error"},this.errors.label)),m("div",{className:"Form-group"},m("label",null,"アイコンURL ",m("span",{className:"required"},"*")),m("input",{className:"FormControl "+(this.errors.iconUrl?"FormControl--error":""),type:"url",placeholder:"https://example.com/icon.svg",bidi:this.iconUrl,required:!0}),this.errors.iconUrl&&m("div",{className:"Form-error"},this.errors.iconUrl),m("div",{className:"helpText"},"アイコンのURLを入力してください。PNG、SVG、JPGなどの画像形式に対応しています。")),m("div",{className:"Form-group"},m("label",null,"プレースホルダー"),m("input",{className:"FormControl",type:"text",placeholder:"https://facebook.com/username",bidi:this.placeholder}),m("div",{className:"helpText"},"ユーザーの入力欄に表示されるプレースホルダー（入力例）を設定します。")),m("div",{className:"Form-group"},m("label",null,"表示順序"),m("input",{className:"FormControl",type:"number",min:"0",bidi:this.sortOrder})),m("div",{className:"Form-group"},m("label",null,"有効状態"),m("div",{style:"display: flex; align-items: center; margin-top: 5px;"},m("div",{className:"switch "+(this.isActive()?"switch--on":"switch--off"),onclick:function(){return t.isActive(!t.isActive())},style:"position: relative; width: 50px; height: 24px; background: "+(this.isActive()?"#4CAF50":"#ccc")+"; border-radius: 12px; cursor: pointer; transition: all 0.2s ease;"},m("div",{className:"switch-thumb",style:"position: absolute; top: 2px; left: "+(this.isActive()?"26px":"2px")+"; width: 20px; height: 20px; background: white; border-radius: 50%; transition: all 0.2s ease; box-shadow: 0 1px 3px rgba(0,0,0,0.3);"})),m("span",{style:"margin-left: 10px; color: #666;"},this.isActive()?"有効":"無効"))),m("div",{className:"Form-group"},v().component({type:"submit",className:"Button Button--primary Button--block",loading:this.loading},this.socialLink?"更新":"作成"))))},r.onsubmit=function(t){var e=this;if(t.preventDefault(),this.errors={},this.name()&&""!==this.name().trim()||(this.errors.name="名前は必須です。"),this.label()&&""!==this.label().trim()||(this.errors.label="表示名は必須です。"),this.iconUrl()&&""!==this.iconUrl().trim())try{new URL(this.iconUrl())}catch(t){this.errors.iconUrl="有効なURLを入力してください。"}else this.errors.iconUrl="アイコンURLは必須です。";if(Object.keys(this.errors).length>0)m.redraw();else{this.loading=!0;var r={name:this.name(),label:this.label(),iconUrl:this.iconUrl(),placeholder:this.placeholder(),sortOrder:parseInt(this.sortOrder())||0,isActive:this.isActive()};(this.socialLink?app.request({url:app.forum.attribute("apiUrl")+"/social-links/"+this.socialLink.id(),method:"PATCH",body:{data:{type:"social-links",id:this.socialLink.id(),attributes:r}}}).then(function(t){return app.store.pushPayload(t),app.store.getById("social-links",e.socialLink.id())}):app.store.createRecord("social-links").save(r)).then(function(){e.hide(),e.attrs.onsubmit&&e.attrs.onsubmit()}).catch(function(t){console.error("Social link save error:",t),t.response&&t.response.errors&&t.response.errors.forEach(function(t){t.source&&"/data/attributes/icon_url"===t.source.pointer&&(e.errors.iconUrl=t.detail||"アイコンURLでエラーが発生しました。")})}).then(function(){e.loading=!1,m.redraw()})}},e}(N()),U=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.loading=!0,this.socialLinks=[],this.loadSocialLinks()},r.loadSocialLinks=function(){var t=this;this.loading=!0,app.store.find("social-links").then(function(e){t.socialLinks=e.sort(function(t,e){return t.sortOrder()-e.sortOrder()}),t.loading=!1,m.redraw()}).catch(function(){t.loading=!1,m.redraw()})},r.view=function(){var t=this;return this.loading?m("div",{className:"Form-group"},m(g(),null)):m("div",{className:"Form-group"},m("label",null,"ソーシャルリンク設定"),m("div",{className:"helpText",style:"margin-bottom: 15px;"},"ユーザーが入力可能なソーシャルリンクを管理できます。"),m("div",{style:"margin-bottom: 15px;"},m(v(),{className:"Button Button--primary",onclick:function(){return t.showModal()}},"新しいソーシャルリンクを追加")),0===this.socialLinks.length?m("div",{className:"helpText"},"ソーシャルリンクが設定されていません。"):m("div",null,this.socialLinks.map(function(e){return t.socialLinkItem(e)})))},r.socialLinkItem=function(t){var e=this;return m("div",{key:t.id(),className:"ExtensionListItem",style:"display: flex; justify-content: space-between; align-items: center; padding: 10px; margin-bottom: 5px; border: 1px solid #ddd; border-radius: 4px;"},m("div",{style:"display: flex; align-items: center;"},t.iconUrl()&&m("img",{src:t.iconUrl(),alt:t.label(),style:"width: 20px; height: 20px; margin-right: 10px;"}),m("div",null,m("div",{style:"font-weight: bold; margin-bottom: 5px;"},t.label(),!t.isActive()&&m("span",{style:"color: #888; margin-left: 5px;"},"(無効)")),m("div",{style:"font-size: 12px; color: #666;"},m("span",null,"名前: ",t.name()),t.placeholder()&&m("span",{style:"margin-left: 15px;"},"プレースホルダー: ",t.placeholder())))),m("div",null,m(v(),{className:"Button Button--link",onclick:function(){return e.showModal(t)},style:"margin-right: 10px;"},"編集"),m(v(),{className:"Button Button--link",onclick:function(){return e.deleteSocialLink(t)}},"削除")))},r.showModal=function(t){var e=this;void 0===t&&(t=null),app.modal.show(O,{socialLink:t,onsubmit:function(){return e.loadSocialLinks()}})},r.deleteSocialLink=function(t){var e=this;confirm("ソーシャルリンク「"+t.label()+"」を削除してもよろしいですか？")&&app.request({url:app.forum.attribute("apiUrl")+"/social-links/"+t.id()+"/delete",method:"POST"}).then(function(){return e.loadSocialLinks()}).catch(function(t){console.error("Delete error:",t)})},e}(f()),q=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var r,i,l=e.prototype;return l.oninit=function(e){t.prototype.oninit.call(this,e),this.loading=!0,this.fields=[],this.loadFields()},l.loadFields=function(){var t=this;this.loading=!0,app.store.find("profile-fields").then(function(e){t.fields=e.sort(function(t,e){return t.sortOrder()-e.sortOrder()}),t.loading=!1,m.redraw()}).catch(function(){t.loading=!1,m.redraw()})},l.view=function(){var t=this;return this.loading?m("div",{className:"Form-group"},m(g(),null)):m("div",null,m("div",{className:"Form-group"},m("label",null,"プロフィールフィールド管理"),m("div",{className:"helpText",style:"margin-bottom: 15px;"},"カスタムプロフィールフィールドを作成・管理できます。"),m("div",{style:"margin-bottom: 15px;"},m(v(),{className:"Button Button--primary",onclick:function(){return t.showModal()}},"新しいフィールドを追加")),0===this.fields.length?m("div",{className:"helpText"},"プロフィールフィールドが設定されていません。"):m("div",null,this.fields.map(function(e){return t.fieldItem(e)}))),m(U,null))},l.fieldItem=function(t){var e=this;return m("div",{key:t.id(),className:"ExtensionListItem",style:"display: flex; justify-content: space-between; align-items: center; padding: 10px; margin-bottom: 5px; border: 1px solid #ddd; border-radius: 4px;"},m("div",null,m("div",{style:"font-weight: bold; margin-bottom: 5px;"},t.label(),t.required()&&m("span",{style:"color: red; margin-left: 5px;"},"*"),!t.isActive()&&m("span",{style:"color: #888; margin-left: 5px;"},"（無効）")),m("div",{style:"font-size: 12px; color: #666;"},m("span",null,"名前: ",t.name()),m("span",{style:"margin-left: 15px;"},"タイプ: ",t.type()))),m("div",null,m(v(),{className:"Button Button--link",onclick:function(){return e.showModal(t)},style:"margin-right: 10px;"},"編集"),m(v(),{className:"Button Button--link",onclick:function(){return e.deleteField(t)}},"削除")))},l.showModal=function(t){var e=this;void 0===t&&(t=null),app.modal.show(L,{field:t,onsubmit:function(){return e.loadFields()}})},l.deleteField=function(t){var e=this;confirm("フィールド「"+t.label()+"」を削除してもよろしいですか？")&&app.request({url:app.forum.attribute("apiUrl")+"/profile-fields/"+t.id()+"/delete",method:"POST"}).then(function(){return e.loadFields()}).catch(function(t){console.error("Delete error:",t)})},r=e,i=[{key:"route",get:function(){return"profile-fields"}}],null&&p(r.prototype,null),i&&p(r,i),Object.defineProperty(r,"prototype",{writable:!1}),r}(f());r().initializers.add("junya-user-profile",function(){r().store.models["user-profiles"]=a,r().store.models["profile-fields"]=s,r().store.models["social-links"]=c,r().extensionData.for("junya-user-profile").registerSetting(function(){return m(q,null)})})})(),module.exports={}})();
//# sourceMappingURL=admin.js.map